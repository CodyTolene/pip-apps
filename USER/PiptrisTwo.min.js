function PipTrisTwo(){function y(){for(let a=j-1;a>=0;a--){let c=!0;for(let e=0;e<b;e++)if(!d[a*b+e]){c=!1;break}if(c){for(let c=0;c<b;c++)q(c,a);for(let c=a;c>0;c--)for(let a=0;a<b;a++)d[c*b+a]=d[(c-1)*b+a];for(let a=0;a<b;a++)d[a]=0;u+=100,a++}}}function i(a){for(let c=0;c<a.shape.length;c++)for(let e=0;e<a.shape[c].length;e++){if(!a.shape[c][e])continue;let f=a.x+e;let g=a.y+c;if(f<0||f>=b||g>=j||g>=0&&d[g*b+f])return!0}return!1}function z(a,b){bC.setColor(3),bC.fillRect(g+a*e,h+b*e,g+(a+1)*e-1,h+(b+1)*e-1)}function c(b){for(let c=0;c<a.shape.length;c++)for(let d=0;d<a.shape[c].length;d++)a.shape[c][d]&&(b?q(a.x+d,a.y+c):z(a.x+d,a.y+c))}function p(){x.apply();for(let a=0;a<j;a++)for(let c=0;c<b;c++)d[a*b+c]?z(c,a):q(c,a);bC.flip()}function D(){if(!a||f)return;c(!0),a.y++,i(a)&&(a.y--,c(!1),A(a),y(),p(),s()),c(!1),bC.flip()}function F(){if(!a||f)return;c(!0);while(!i(a))a.y++;a.y--,c(!1),A(a),y(),p(),s(),c(!1),bC.flip()}function q(a,b){bC.setColor(0,0,0),bC.fillRect(g+a*e,h+b*e,g+(a+1)*e-1,h+(b+1)*e-1)}function r(){let c=Math.floor(Math.random()*w.length);let a=w[c];let d=Math.floor((b-a[0].length)/2);return{shape:a,x:d,y:0}}function G(b){let a=Date.now();if(a-v<C)return;v=a,b===0?F():L(b)}function H(a){J(a>0?1:-1)}function I(){Pip.removeAllListeners(m),Pip.removeAllListeners(n),Pip.removeAllListeners(o),clearInterval(l),bC.clear(1).flip(),E.reboot()}function A(a){for(let c=0;c<a.shape.length;c++)for(let e=0;e<a.shape[c].length;e++)a.shape[c][e]&&(d[(a.y+c)*b+a.x+e]=1)}function J(b){if(f||!a)return;c(!0),a.x+=b,i(a)&&(a.x-=b),c(!1),bC.flip()}function K(){for(let a=0;a<d.length;a++)d[a]=0;bC.clear(1).flip()}function L(g){if(f||!a)return;let b=a.shape;let d=g>0?b[0].map((c,a)=>b.map(b=>b[b.length-1-a])):b[0].map((c,a)=>b.map(b=>b[a]).reverse());c(!0);let e=a.shape;a.shape=d,i(a)&&(a.shape=e),c(!1),bC.flip()}function s(){a=k||r(),k=r(),i(a)&&(f=!0,x.set(0,1,0).apply(),bC.setFontMonofonto18(),bC.drawString('GAME OVER',g,h+40),bC.flip(),clearInterval(l))}const t={};const M='PiptrisTwo';const N='2.0.0';const e=10;const B=800;const b=16;const j=20;const d=new Uint8Array(b*j);const g=120;const h=0;let a=null;let k=null;let l=null;let f=!1;let u=0;const m='knob1';const n='knob2';const o='torch';const C=100;let v=0;const w=[[[1,1,1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]],[[0,1,0],[1,1,1]],[[1,1],[1,1]]];const x={self:[0,1,0],apply:function(){bC.setColor(this.self[0],this.self[1],this.self[2])},get:function(){return this.self},set:function(a,b,c,d){if(a===undefined||b===undefined||c===undefined||d){const a=bC.getColor().toString(16);for(let e=0;e<3;e++)this.self[e]=parseInt(a.charAt(e),16)/15}else this.self[0]=a,this.self[1]=b,this.self[2]=c;return this}};return t.run=function(){K(),u=0,f=!1,k=r(),s(),p(),l=setInterval(D,B),Pip.removeAllListeners(m),Pip.removeAllListeners(n),Pip.removeAllListeners(o),Pip.on(m,G),Pip.on(n,H),Pip.on(o,I)},t}PipTrisTwo().run()